<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merged Game: Flags & Drawing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Starter Screen Styles */
        #starter-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #1a202c; /* Dark background for starter screen */
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            text-align: center;
        }
        #starter-screen h1 {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            color: #f6ad55; /* A nice orange/gold color */
        }
        #start-button {
            background-color: #4299e1; /* Blue */
            color: white;
            font-size: 1.5rem;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        #start-button:hover {
            background-color: #3182ce; /* Darker blue on hover */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
        }
        .game-container {
            max-width: 600px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .flag-image {
            width: 200px; /* Increased size */
            height: 120px; /* Adjusted for typical flag aspect ratio */
            object-fit: cover; /* Changed to cover to maintain aspect ratio better */
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin: 0 auto 1.5rem auto; /* Center the flag */
            display: block;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .option-button {
            transition: all 0.2s ease-in-out;
        }
        .option-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }
        .correct-answer {
            background-color: #4ade80 !important; /* Tailwind green-400 */
            color: white !important;
            border-color: #22c55e !important; /* Tailwind green-600 */
        }
        .incorrect-answer {
            background-color: #f87171 !important; /* Tailwind red-400 */
            color: white !important;
            border-color: #ef4444 !important; /* Tailwind red-500 */
        }
        .fact-list li {
            padding-left: 1.5em;
            position: relative;
        }
        .fact-list li::before {
            content: "⭐"; /* Using a star emoji as a bullet point */
            position: absolute;
            left: 0;
            color: #fbbf24; /* Tailwind amber-400 */
        }
        #message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 1000;
            font-size: 0.9rem;
            font-weight: 600;
            display: none; /* Hidden by default */
        }
        #message-box.success {
            background-color: #34d399; /* Tailwind emerald-400 */
            color: white;
        }
        #message-box.error {
            background-color: #f87171; /* Tailwind red-400 */
            color: white;
        }

        /* Custom styles for the canvas to ensure it fits the container */
        canvas {
            touch-action: none; /* Prevent default touch actions like scrolling/zooming */
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <div id="starter-screen">
        <h1>GTA IS Not Coming —— Filler v2</h1>
        <button id="start-button">Start Game</button>
    </div>

    <div id="game-content" style="display: none;">
        <div id="message-box"></div>

        <div class="game-container w-full">
            <h1 id="game-title" class="text-3xl font-bold text-center text-slate-700 mb-8"></h1>

            <!-- Flag Guessing Section -->
            <div id="flag-game-section">
                <img id="flag-image" src="https://placehold.co/200x120/e2e8f0/333333?text=Loading+Flag..." alt="Country Flag" class="flag-image">

                <div id="country-options" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                </div>

                <div id="feedback-section" class="mb-6 text-center">
                    <p id="feedback-message" class="text-lg font-semibold"></p>
                </div>

                <div id="facts-section" class="hidden mb-6 p-4 bg-sky-50 border border-sky-200 rounded-lg">
                    <h3 class="text-xl font-semibold text-sky-700 mb-2">Did you know?</h3>
                    <ul id="fact-list" class="list-none space-y-2 text-slate-600">
                    </ul>
                </div>

                <div class="text-center">
                    <button id="next-button" class="hidden bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-150 ease-in-out">
                        Your Turn
                    </button>
                </div>
            </div>

            <!-- Drawing Guessing Section -->
            <div id="drawing-game-section" class="hidden flex flex-col items-center space-y-6">
                <canvas id="drawingCanvas" class="bg-gray-50 border-2 border-gray-300 rounded-lg w-full aspect-video max-w-full"></canvas>

                <div class="flex flex-wrap justify-center gap-4 w-full">
                    <button id="clearBtn" class="px-6 py-3 bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-75 transition duration-200 ease-in-out transform hover:scale-105">
                        Clear Drawing
                    </button>
                    <button id="guessBtn" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:ring-opacity-75 transition duration-200 ease-in-out transform hover:scale-105">
                        What is it, Harry?
                    </button>
                    <button id="downloadBtn" class="px-6 py-3 bg-green-500 text-white font-semibold rounded-lg shadow-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-75 transition duration-200 ease-in-out transform hover:scale-105">
                        Download Drawing
                    </button>
                </div>

                <div id="resultContainer" class="text-center w-full">
                    <p id="resultText" class="text-xl font-medium text-gray-700"></p>
                    <p id="loadingIndicator" class="text-lg font-semibold text-purple-600 hidden mt-2">
                        Harry is thinking...
                    </p>
                </div>
                <div id="ai-feedback-buttons" class="flex flex-wrap justify-center gap-4 w-full hidden">
                    <button id="aiCorrectBtn" class="px-6 py-3 bg-green-500 text-white font-semibold rounded-lg shadow-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-75 transition duration-200 ease-in-out transform hover:scale-105">
                        Harry was Correct!
                    </button>
                    <button id="aiWrongBtn" class="px-6 py-3 bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-75 transition duration-200 ease-in-out transform hover:scale-105">
                        You're Wrong!
                    </button>
                </div>
            </div>

            <div class="mt-8 text-center">
                <p class="text-slate-600">Your Score: <span id="user-score" class="font-bold text-slate-800">0</span></p>
                <p class="text-slate-600">AI Score: <span id="ai-score" class="font-bold text-slate-800">0</span></p>
                <p class="text-slate-500 text-sm">Flags seen: <span id="flags-seen" class="font-bold text-slate-700">0</span> / <span id="total-flags">0</span></p>
                <p class="text-slate-500 text-sm mt-2">Round: <span id="current-round" class="font-bold text-slate-700">0</span> / <span id="total-rounds" class="font-bold text-slate-700">20</span> (<span id="rounds-left" class="font-bold text-slate-700">20</span> left)</p>
            </div>

        </div>
    </div>

    <script type="module">
        // Gemini API Configuration
        const API_KEY = "AIzaSyAfTGMc0Qgi8zVya0-jesmC77GUD60xFvQ";
        const GEMINI_MODEL = "gemini-1.5-flash";

        // --- Game Data ---
        const countriesData = [
            { name: "Japan", code: "jp", flagUrl: "https://flagcdn.com/w320/jp.png", facts: ["Known as 'Hinomaru'.", "The red disc represents the sun.", "White symbolizes purity and honesty."] },
            { name: "Canada", code: "ca", flagUrl: "https://flagcdn.com/w320/ca.png", facts: ["Features a maple leaf.", "Red bands for oceans.", "Known as the Maple Leaf Flag."] },
            { name: "Brazil", code: "br", flagUrl: "https://flagcdn.com/w320/br.png", facts: ["Green for forests, yellow for wealth.", "Blue circle with stars.", "Motto: 'Ordem e Progresso'."] },
            { name: "South Africa", code: "za", flagUrl: "https://flagcdn.com/w320/za.png", facts: ["'Y' shape for unity.", "Colorful design.", "Adopted post-apartheid in 1994."] },
            { name: "United States", code: "us", flagUrl: "https://flagcdn.com/w320/us.png", facts: ["13 stripes for colonies.", "50 stars for states.", "Red for valor, white for purity, blue for justice."] },
            { name: "Germany", code: "de", flagUrl: "https://flagcdn.com/w320/de.png", facts: ["Black, red, and gold tricolor.", "Symbolizes unity and freedom.", "Used by nationalists in 19th century."] },
            { name: "India", code: "in", flagUrl: "https://flagcdn.com/w320/in.png", facts: ["Saffron for courage.", "White for peace with Dharma Chakra.", "Green for fertility."] },
            { name: "Australia", code: "au", flagUrl: "https://flagcdn.com/w320/au.png", facts: ["Union Jack in canton.", "Commonwealth Star.", "Southern Cross constellation."] },
            { name: "France", code: "fr", flagUrl: "https://flagcdn.com/w320/fr.png", facts: ["Known as 'Tricolore'.", "Blue and red for Paris, white for monarchy.", "Symbolizes liberty, equality, fraternity."] },
            { name: "China", code: "cn", flagUrl: "https://flagcdn.com/w320/cn.png", facts: ["Red for revolution.", "Large yellow star for Communist Party.", "Four smaller stars for social classes."] },
            { name: "United Kingdom", code: "gb", flagUrl: "https://flagcdn.com/w320/gb.png", facts: ["Union Jack combines saint crosses.", "St George's, St Andrew's, St Patrick's.", "Wales not directly represented."] },
            { name: "Italy", code: "it", flagUrl: "https://flagcdn.com/w320/it.png", facts: ["Green, white, and red tricolour.", "Green for hope, white for faith, red for charity.", "Inspired by French flag."] },
            { name: "Mexico", code: "mx", flagUrl: "https://flagcdn.com/w320/mx.png", facts: ["Eagle devouring snake.", "Green for hope, white for purity, red for heroes.", "Rooted in Aztec legend."] },
            { name: "Egypt", code: "eg", flagUrl: "https://flagcdn.com/w320/eg.png", facts: ["Red for struggle.", "White for bloodless revolution.", "Black for end of oppression.", "Golden Eagle of Saladin."] },
            { name: "Argentina", code: "ar", flagUrl: "https://flagcdn.com/w320/ar.png", facts: ["Blue for sky, white for clouds.", "Sun of May in center.", "Sun's face is Inti, Inca sun god."] },
            { name: "South Korea", code: "kr", flagUrl: "https://flagcdn.com/w320/kr.png", facts: ["White for purity and peace.", "Taegeuk (Yin-Yang) symbol.", "Four trigrams for heaven, earth, water, fire."] },
            { name: "Spain", code: "es", flagUrl: "https://flagcdn.com/w320/es.png", facts: ["Red and yellow traditional colors.", "Coat of arms with Pillars of Hercules.", "Motto: 'Plus Ultra'."] },
            { name: "Sweden", code: "se", flagUrl: "https://flagcdn.com/w320/se.png", facts: ["Blue for truth, loyalty, justice.", "Yellow Nordic cross for Christianity.", "Based on Danish flag."] },
            { name: "New Zealand", code: "nz", flagUrl: "https://flagcdn.com/w320/nz.png", facts: ["Union Jack in canton.", "Commonwealth Star.", "Southern Cross constellation.", "Blue for sea and sky."] },
            { name: "Turkey", code: "tr", flagUrl: "https://flagcdn.com/w320/tr.png", facts: ["Red for independence.", "Star and crescent for Islam.", "Used for centuries."] },
            { name: "Afghanistan", code: "af", flagUrl: "https://flagcdn.com/w320/af.png", facts: ["A tricolor flag.", "Features the national emblem.", "Adopted in 2013."] },
            { name: "Albania", code: "al", flagUrl: "https://flagcdn.com/w320/al.png", facts: ["Red with a black double-headed eagle.", "Symbolizes sovereignty.", "Adopted in 1912."] },
            { name: "Algeria", code: "dz", flagUrl: "https://flagcdn.com/w320/dz.png", facts: ["Green and white with a red star and crescent.", "Green for Islam, white for peace.", "Star and crescent for Islam and hope."] },
            { name: "Andorra", code: "ad", flagUrl: "https://flagcdn.com/w320/ad.png", facts: ["Blue, yellow, and red vertical tricolor.", "Features the coat of arms.", "Symbolizes independence."] },
            { name: "Angola", code: "ao", flagUrl: "https://flagcdn.com/w320/ao.png", facts: ["Red and black with a yellow emblem.", "Emblem includes a gear, machete, and star.", "Red for bloodshed, black for Africa."] },
            { name: "Antigua and Barbuda", code: "ag", flagUrl: "https://flagcdn.com/w320/ag.png", facts: ["Red, black, blue, and white design.", "Sun symbolizes new era.", "Red for dynamism, black for African heritage."] },
            { name: "Armenia", code: "am", flagUrl: "https://flagcdn.com/w320/am.png", facts: ["Red, blue, and orange horizontal tricolor.", "Red for Armenian Highlands, blue for hope, orange for courage.", "Adopted in 1990."] },
            { name: "Austria", code: "at", flagUrl: "https://flagcdn.com/w320/at.png", facts: ["Red-white-red horizontal tricolor.", "One of the oldest national flags.", "Legend links it to Duke Leopold V."] },
            { name: "Azerbaijan", code: "az", flagUrl: "https://flagcdn.com/w320/az.png", facts: ["Blue, red, and green horizontal tricolor.", "Features a white crescent and eight-pointed star.", "Blue for Turkic heritage, red for progress, green for Islam."] },
            { name: "Bahamas", code: "bs", flagUrl: "https://flagcdn.com/w320/bs.png", facts: ["Aquamarine, gold, and black design.", "Black for strength, gold for sun/sand, aquamarine for sea.", "Adopted in 1973."] },
            { name: "Bahrain", code: "bh", flagUrl: "https://flagcdn.com/w320/bh.png", facts: ["Red with a white serrated band.", "Five triangles represent the five pillars of Islam.", "Red is the traditional color of flags in the region."] },
            { name: "Bangladesh", code: "bd", flagUrl: "https://flagcdn.com/w320/bd.png", facts: ["Green with a red disc.", "Green for lushness, red for sun/sacrifice.", "Adopted in 1972."] },
            { name: "Barbados", code: "bb", flagUrl: "https://flagcdn.com/w320/bb.png", facts: ["Blue and gold vertical bands with a trident.", "Blue for oceans, gold for sand.", "Trident symbolizes independence from colonial past."] },
            { name: "Belarus", code: "by", flagUrl: "https://flagcdn.com/w320/by.png", facts: ["Red and green with an ornamental pattern.", "Red for strength, green for hope.", "Pattern symbolizes cultural heritage."] },
            { name: "Belgium", code: "be", flagUrl: "https://flagcdn.com/w320/be.png", facts: ["Black, yellow, and red vertical tricolor.", "Colors derived from the Duchy of Brabant.", "Adopted in 1831."] },
            { name: "Belize", code: "bz", flagUrl: "https://flagcdn.com/w320/bz.png", facts: ["Blue with red stripes and a coat of arms.", "Coat of arms depicts woodcutters.", "Blue for the sea, red for unity."] },
            { name: "Benin", code: "bj", flagUrl: "https://flagcdn.com/w320/bj.png", facts: ["Green, yellow, and red.", "Pan-African colors.", "Green for hope, yellow for wealth, red for courage."] },
            { name: "Bhutan", code: "bt", flagUrl: "https://flagcdn.com/w320/bt.png", facts: ["Orange and yellow with a white dragon.", "Dragon is Druk, the Thunder Dragon.", "Orange for spiritual authority, yellow for civil authority."] },
            { name: "Bolivia", code: "bo", flagUrl: "https://flagcdn.com/w320/bo.png", facts: ["Red, yellow, and green horizontal tricolor.", "Red for valor, yellow for mineral wealth, green for fertility.", "Adopted in 1851."] },
            { name: "Bosnia and Herzegovina", code: "ba", flagUrl: "https://flagcdn.com/w320/ba.png", facts: ["Blue with a yellow triangle and white stars.", "Triangle represents the country's shape.", "Stars for Europe."] },
            { name: "Botswana", code: "bw", flagUrl: "https://flagcdn.com/w320/bw.png", facts: ["Light blue with a black horizontal stripe.", "Black stripe bordered by white.", "Blue for water, black and white for racial harmony."] },
            { name: "Bulgaria", code: "bg", flagUrl: "https://flagcdn.com/w320/bg.png", facts: ["White, green, and red horizontal tricolor.", "White for peace, green for fertility, red for courage.", "Adopted in 1879."] },
            { name: "Burkina Faso", code: "bf", flagUrl: "https://flagcdn.com/w320/bf.png", facts: ["Red and green with a yellow star.", "Red for revolution, green for abundance.", "Star for guiding light."] },
            { name: "Burundi", code: "bi", flagUrl: "https://flagcdn.com/w320/bi.png", facts: ["White saltire with red and green triangles.", "Three stars represent national motto: Unity, Work, Progress.", "Red for sacrifice, green for hope, white for peace."] },
            { name: "Cambodia", code: "kh", flagUrl: "https://flagcdn.com/w320/kh.png", facts: ["Blue and red with Angkor Wat.", "Angkor Wat is a famous temple complex.", "Blue for royalty, red for nation."] },
            { name: "Cameroon", code: "cm", flagUrl: "https://flagcdn.com/w320/cm.png", facts: ["Green, red, and yellow vertical tricolor with a star.", "Green for forests, red for unity, yellow for sun.", "Star for unity."] },
            { name: "Cape Verde", code: "cv", flagUrl: "https://flagcdn.com/w320/cv.png", facts: ["Blue with a white and red horizontal stripe and ten stars.", "Blue for ocean, white for peace, red for effort.", "Stars for islands."] },
            { name: "Central African Republic", code: "cf", flagUrl: "https://flagcdn.com/w320/cf.png", facts: ["Blue, white, green, and yellow horizontal stripes with a red vertical stripe and star.", "Pan-African and French colors.", "Red for blood, star for guiding light."] },
            { name: "Chad", code: "td", flagUrl: "https://flagcdn.com/w320/td.png", facts: ["Blue, yellow, and red vertical tricolor.", "Blue for sky/hope, yellow for sun/desert, red for sacrifice.", "Similar to Romanian flag."] },
            { name: "Chile", code: "cl", flagUrl: "https://flagcdn.com/w320/cl.png", facts: ["White and red stripes with a blue square and star.", "Blue for sky, white for Andes snow, red for blood.", "Star for independence."] },
            { name: "Colombia", code: "co", flagUrl: "https://flagcdn.com/w320/co.png", facts: ["Yellow, blue, and red horizontal tricolor.", "Yellow for wealth, blue for oceans, red for sacrifice.", "Inspired by Francisco de Miranda."] },
            { name: "Comoros", code: "km", flagUrl: "https://flagcdn.com/w320/km.png", facts: ["Yellow, white, red, and blue stripes with a green triangle, crescent, and stars.", "Four stars for the islands.", "Green for Islam, yellow for sun, white for purity, red for sacrifice, blue for Indian Ocean."] },
            { name: "Congo (Dem. Rep.)", code: "cd", flagUrl: "https://flagcdn.com/w320/cd.png", facts: ["Light blue with a yellow star and red diagonal stripe.", "Blue for peace, red for martyrs' blood, yellow for wealth.", "Star for bright future."] },
            { name: "Congo (Rep.)", code: "cg", flagUrl: "https://flagcdn.com/w320/cg.png", facts: ["Green, yellow, and red diagonal tricolor.", "Pan-African colors.", "Green for agriculture, yellow for friendship, red for struggle."] },
            { name: "Costa Rica", code: "cr", flagUrl: "https://flagcdn.com/w320/cr.png", facts: ["Blue, white, and red horizontal stripes.", "Red stripe is wider.", "Blue for sky, white for peace, red for warmth and generosity."] },
            { name: "Croatia", code: "hr", flagUrl: "https://flagcdn.com/w320/hr.png", facts: ["Red, white, and blue horizontal tricolor.", "Features the coat of arms.", "Colors represent historical Croatian lands."] },
            { name: "Cuba", code: "cu", flagUrl: "https://flagcdn.com/w320/cu.png", facts: ["Blue and white stripes with a red triangle and star.", "Blue for sea, white for purity, red for blood.", "Star for independence."] },
            { name: "Cyprus", code: "cy", flagUrl: "https://flagcdn.com/w320/cy.png", facts: ["White with a map of the island and olive branches.", "Map is copper-orange, symbolizing copper.", "Olive branches for peace."] },
            { name: "Czech Republic", code: "cz", flagUrl: "https://flagcdn.com/w320/cz.png", facts: ["White and red horizontal stripes with a blue triangle.", "White for Bohemia, red for Moravia, blue for Slovakia (historical).", "Adopted in 1920."] },
            { name: "Denmark", code: "dk", flagUrl: "https://flagcdn.com/w320/dk.png", facts: ["Red with a white Nordic cross.", "Known as 'Dannebrog'.", "One of the oldest national flags still in use."] },
            { name: "Djibouti", code: "dj", flagUrl: "https://flagcdn.com/w320/dj.png", facts: ["Light blue and green horizontal stripes with a white triangle and red star.", "Blue for sea, green for earth, white for peace.", "Star for unity."] },
            { name: "Dominica", code: "dm", flagUrl: "https://flagcdn.com/w320/dm.png", facts: ["Green with a cross of yellow, black, and white.", "Features a Sisserou parrot.", "Green for vegetation, cross for Christianity."] },
            { name: "Dominican Republic", code: "do", flagUrl: "https://flagcdn.com/w320/do.png", facts: ["White cross dividing blue and red quarters.", "Features the coat of arms.", "Blue for liberty, red for blood, white for salvation."] },
            { name: "Ecuador", code: "ec", flagUrl: "https://flagcdn.com/w320/ec.png", facts: ["Yellow, blue, and red horizontal tricolor.", "Yellow is wider.", "Features the coat of arms."] },
            { name: "El Salvador", code: "sv", flagUrl: "https://flagcdn.com/w320/sv.png", facts: ["Blue and white horizontal stripes with a coat of arms.", "Blue for oceans, white for peace.", "Coat of arms symbolizes the Central American Federation."] },
            { name: "Equatorial Guinea", code: "gq", flagUrl: "https://flagcdn.com/w320/gq.png", facts: ["Green, white, and red horizontal stripes with a blue triangle and coat of arms.", "Green for forests, white for peace, red for blood.", "Blue for the sea."] },
            { name: "Eritrea", code: "er", flagUrl: "https://flagcdn.com/w320/er.png", facts: ["Green, blue, and red triangles with a wreath and olive branch.", "Green for agriculture, blue for sea, red for blood.", "Wreath for peace."] },
            { name: "Estonia", code: "ee", flagUrl: "https://flagcdn.com/w320/ee.png", facts: ["Blue, black, and white horizontal tricolor.", "Blue for sky, black for soil, white for snow.", "Symbolizes independence."] },
            { name: "Eswatini", code: "sz", flagUrl: "https://flagcdn.com/w320/sz.png", facts: ["Blue, yellow, and red horizontal stripes with a shield and spears.", "Shield and spears symbolize protection.", "Blue for peace, yellow for resources, red for battles."] },
            { name: "Ethiopia", code: "et", flagUrl: "https://flagcdn.com/w320/et.png", facts: ["Green, yellow, and red horizontal tricolor with an emblem.", "Emblem is a pentagram.", "Green for land, yellow for peace, red for strength."] },
            { name: "Fiji", code: "fj", flagUrl: "https://flagcdn.com/w320/fj.png", facts: ["Light blue with the Union Jack and coat of arms.", "Light blue for Pacific Ocean.", "Coat of arms features a lion and sugarcane."] },
            { name: "Finland", code: "fi", flagUrl: "https://flagcdn.com/w320/fi.png", facts: ["White with a blue Nordic cross.", "White for snow, blue for lakes and sky.", "Known as 'Siniristilippu'."] },
            { name: "Gabon", code: "ga", flagUrl: "https://flagcdn.com/w320/ga.png", facts: ["Green, yellow, and blue horizontal tricolor.", "Green for forests, yellow for sun, blue for sea.", "Adopted in 1960."] },
            { name: "Gambia", code: "gm", flagUrl: "https://flagcdn.com/w320/gm.png", facts: ["Red, blue, and green horizontal stripes with white fimbriations.", "Red for sun, blue for river, green for land.", "White for peace."] },
            { name: "Georgia", code: "ge", flagUrl: "https://flagcdn.com/w320/ge.png", facts: ["White with a large red cross and four smaller crosses.", "Known as the 'Five Cross Flag'.", "Dates back to the 14th century."] },
            { name: "Ghana", code: "gh", flagUrl: "https://flagcdn.com/w320/gh.png", facts: ["Red, yellow, and green horizontal tricolor with a black star.", "Pan-African colors.", "Black star for African freedom."] },
            { name: "Greece", code: "gr", flagUrl: "https://flagcdn.com/w320/gr.png", facts: ["Blue and white stripes with a white cross.", "Nine stripes for syllables of 'Eleftheria i Thanatos'.", "Blue for sea/sky, white for purity."] },
            { name: "Grenada", code: "gd", flagUrl: "https://flagcdn.com/w320/gd.png", facts: ["Red border with seven yellow stars, yellow and green triangles, and a nutmeg.", "Nutmeg symbolizes the island's main crop.", "Stars for parishes."] },
            { name: "Guatemala", code: "gt", flagUrl: "https://flagcdn.com/w320/gt.png", facts: ["Light blue and white vertical tricolor with a coat of arms.", "Blue for oceans, white for peace.", "Coat of arms features a quetzal bird."] },
            { name: "Guinea", code: "gn", flagUrl: "https://flagcdn.com/w320/gn.png", facts: ["Red, yellow, and green vertical tricolor.", "Pan-African colors.", "Red for sacrifice, yellow for sun, green for vegetation."] },
            { name: "Guinea-Bissau", code: "gw", flagUrl: "https://flagcdn.com/w320/gw.png", facts: ["Red vertical stripe with a black star, and yellow and green horizontal stripes.", "Red for struggle, black star for Africa, yellow for wealth, green for hope."] },
            { name: "Guyana", code: "gy", flagUrl: "https://flagcdn.com/w320/gy.png", facts: ["Green with a red triangle, black fimbriation, and yellow triangle, white fimbriation.", "Green for agriculture, white for rivers, gold for mineral wealth, black for endurance, red for zeal."] },
            { name: "Haiti", code: "ht", flagUrl: "https://flagcdn.com/w320/ht.png", facts: ["Blue and red horizontal bicolor with a coat of arms.", "Blue for union of black and mulatto, red for blood.", "Coat of arms features a palm tree."] },
            { name: "Honduras", code: "hn", flagUrl: "https://flagcdn.com/w320/hn.png", facts: ["Blue and white horizontal stripes with five blue stars.", "Blue for oceans, white for peace.", "Stars represent the former Federal Republic of Central America."] },
            { name: "Hungary", code: "hu", flagUrl: "https://flagcdn.com/w320/hu.png", facts: ["Red, white, and green horizontal tricolor.", "Red for strength, white for faithfulness, green for hope.", "Adopted in 1848."] },
            { name: "Iceland", code: "is", flagUrl: "https://flagcdn.com/w320/is.png", facts: ["Blue with a red Nordic cross bordered in white.", "Blue for mountains, white for snow, red for volcanic fire.", "Adopted in 1915."] },
            { name: "Indonesia", code: "id", flagUrl: "https://flagcdn.com/w320/id.png", facts: ["Red and white horizontal bicolor.", "Red for courage, white for purity.", "Similar to Monaco's flag."] },
            { name: "Iran", code: "ir", flagUrl: "https://flagcdn.com/w320/ir.png", facts: ["Green, white, and red horizontal tricolor with an emblem.", "Emblem is a stylized word for Allah.", "Green for growth, white for peace, red for courage."] },
            { name: "Iraq", code: "iq", flagUrl: "https://flagcdn.com/w320/iq.png", facts: ["Red, white, and black horizontal stripes with 'Allahu Akbar' in green.", "Red for courage, white for generosity, black for Islam.", "Text means 'God is the greatest'."] },
            { name: "Ireland", code: "ie", flagUrl: "https://flagcdn.com/w320/ie.png", facts: ["Green, white, and orange vertical tricolor.", "Green for Catholics, orange for Protestants, white for peace.", "Adopted in 1919."] },
            { name: "Israel", code: "il", flagUrl: "https://flagcdn.com/w320/il.png", facts: ["White with two blue horizontal stripes and a Star of David.", "Blue stripes symbolize a tallit (Jewish prayer shawl).", "Star of David is a symbol of Judaism."] },
            { name: "Jamaica", code: "jm", flagUrl: "https://flagcdn.com/w320/jm.png", facts: ["Green triangles, black diagonal cross, and yellow saltire.", "Green for hope, black for strength, yellow for sun/wealth.", "Adopted in 1962."] },
            { name: "Jordan", code: "jo", flagUrl: "https://flagcdn.com/w320/jo.png", facts: ["Black, white, and green horizontal stripes with a red triangle and white star.", "Black for Abbasid, white for Umayyad, green for Fatimid.", "Star for unity."] },
            { name: "Kazakhstan", code: "kz", flagUrl: "https://flagcdn.com/w320/kz.png", facts: ["Light blue with a golden sun, eagle, and ornamental pattern.", "Blue for sky/freedom, gold for sun/wealth.", "Eagle symbolizes independence."] },
            { name: "Kenya", code: "ke", flagUrl: "https://flagcdn.com/w320/ke.png", facts: ["Black, red, and green horizontal stripes with a shield and spears.", "Black for people, red for blood, green for natural wealth.", "Shield and spears for defense."] },
            { name: "Kuwait", code: "kw", flagUrl: "https://flagcdn.com/w320/kw.png", facts: ["Green, white, and red horizontal stripes with a black trapezoid.", "Green for land, white for deeds, red for swords, black for battles.", "Adopted in 1961."] },
            { name: "Kyrgyzstan", code: "kg", flagUrl: "https://flagcdn.com/w320/kg.png", facts: ["Red with a yellow sun and yurt top.", "Sun represents peace and wealth.", "Yurt top symbolizes home."] },
            { name: "Laos", code: "la", flagUrl: "https://flagcdn.com/w320/la.png", facts: ["Red, blue, and red horizontal stripes with a white disc.", "Red for blood, blue for prosperity, white disc for moon/unity.", "Adopted in 1975."] },
            { name: "Latvia", code: "lv", flagUrl: "https://flagcdn.com/w320/lv.png", facts: ["Carmine red and white horizontal stripes.", "Red for blood shed for freedom, white for law and truth.", "Adopted in 1918."] },
            { name: "Lebanon", code: "lb", flagUrl: "https://flagcdn.com/w320/lb.png", facts: ["Red and white horizontal stripes with a green cedar tree.", "Red for sacrifice, white for snow/peace.", "Cedar tree is a national symbol."] },
            { name: "Lesotho", code: "ls", flagUrl: "https://flagcdn.com/w320/ls.png", facts: ["Blue, white, and green horizontal stripes with a black mokorotlo.", "Mokorotlo is a traditional Basotho hat.", "Blue for rain, white for peace, green for prosperity."] },
            { name: "Liberia", code: "lr", flagUrl: "https://flagcdn.com/w320/lr.png", facts: ["Eleven red and white stripes with a blue square and white star.", "Eleven stripes for signatories of Declaration of Independence.", "Star for freedom."] },
            { name: "Libya", code: "ly", flagUrl: "https://flagcdn.com/w320/ly.png", facts: ["Red, black, and green horizontal stripes with a white star and crescent.", "Red for martyrs, black for dark days, green for prosperity.", "Star and crescent for Islam."] },
            { name: "Liechtenstein", code: "li", flagUrl: "https://flagcdn.com/w320/li.png", facts: ["Blue and red horizontal bicolor with a golden crown.", "Blue for sky, red for evening fires.", "Crown for princely authority."] },
            { name: "Lithuania", code: "lt", flagUrl: "https://flagcdn.com/w320/lt.png", facts: ["Yellow, green, and red horizontal tricolor.", "Yellow for sun/prosperity, green for forests/hope, red for blood/courage.", "Adopted in 1989."] },
            { name: "Luxembourg", code: "lu", flagUrl: "https://flagcdn.com/w320/lu.png", facts: ["Red, white, and light blue horizontal tricolor.", "Similar to the Netherlands flag.", "Adopted in 1972."] },
            { name: "Madagascar", code: "mg", flagUrl: "https://flagcdn.com/w320/mg.png", facts: ["White vertical band with red and green horizontal bands.", "White for purity, red for sovereignty, green for hope.", "Adopted in 1958."] },
            { name: "Malawi", code: "mw", flagUrl: "https://flagcdn.com/w320/mw.png", facts: ["Black, red, and green horizontal stripes with a rising sun.", "Black for African people, red for martyrs, green for nature.", "Rising sun for dawn of hope."] },
            { name: "Malaysia", code: "my", flagUrl: "https://flagcdn.com/w320/my.png", facts: ["Red and white stripes with a blue canton and crescent and star.", "14 stripes for states and federal territories.", "Crescent and star for Islam."] },
            { name: "Maldives", code: "mv", flagUrl: "https://flagcdn.com/w320/mv.png", facts: ["Red with a large green rectangle and white crescent.", "Red for courage, green for peace, white crescent for Islam.", "Adopted in 1965."] },
            { name: "Mali", code: "ml", flagUrl: "https://flagcdn.com/w320/ml.png", facts: ["Green, yellow, and red vertical tricolor.", "Pan-African colors.", "Green for hope, yellow for wealth, red for sacrifice."] },
            { name: "Malta", code: "mt", flagUrl: "https://flagcdn.com/w320/mt.png", facts: ["White and red vertical bicolor with a George Cross.", "George Cross awarded for bravery during WWII.", "White and red are traditional colors."] },
            { name: "Mauritania", code: "mr", flagUrl: "https://flagcdn.com/w320/mr.png", facts: ["Green with a yellow star and crescent and two red stripes.", "Green for Islam, yellow for Sahara desert, red for blood.", "Star and crescent for Islam."] },
            { name: "Mauritius", code: "mu", flagUrl: "https://flagcdn.com/w320/mu.png", facts: ["Red, blue, yellow, and green horizontal stripes.", "Red for struggle, blue for Indian Ocean, yellow for independence, green for agriculture.", "Adopted in 1968."] },
            { name: "Moldova", code: "md", flagUrl: "https://flagcdn.com/w320/md.png", facts: ["Blue, yellow, and red vertical tricolor with a coat of arms.", "Coat of arms features an eagle and aurochs head.", "Blue for sky, yellow for sun, red for courage."] },
            { name: "Monaco", code: "mc", flagUrl: "https://flagcdn.com/w320/mc.png", facts: ["Red and white horizontal bicolor.", "Colors of the Grimaldi family.", "Similar to Indonesia's flag."] },
            { name: "Mongolia", code: "mn", flagUrl: "https://flagcdn.com/w320/mn.png", facts: ["Red and blue vertical bands with a Soyombo emblem.", "Soyombo is a national symbol.", "Red for prosperity, blue for sky."] },
            { name: "Montenegro", code: "me", flagUrl: "https://flagcdn.com/w320/me.png", facts: ["Red with a golden border and coat of arms.", "Coat of arms features a double-headed eagle.", "Adopted in 2004."] },
            { name: "Morocco", code: "ma", flagUrl: "https://flagcdn.com/w320/ma.png", facts: ["Red with a green pentagram.", "Pentagram is the Seal of Solomon.", "Red for courage, green for hope."] },
            { name: "Mozambique", code: "mz", flagUrl: "https://flagcdn.com/w320/mz.png", facts: ["Green, black, and yellow horizontal stripes with a red triangle, star, hoe, and rifle.", "Green for land, black for Africa, yellow for wealth.", "Red for struggle."] },
            { name: "Myanmar", code: "mm", flagUrl: "https://flagcdn.com/w320/mm.png", facts: ["Yellow, green, and red horizontal stripes with a white star.", "Yellow for solidarity, green for peace, red for courage.", "Star for unity."] },
            { name: "Namibia", code: "na", flagUrl: "https://flagcdn.com/w320/na.png", facts: ["Blue, red, and green diagonal stripes with a golden sun.", "Blue for sky, red for people, green for vegetation.", "Sun for life."] },
            { name: "Nepal", code: "np", flagUrl: "https://flagcdn.com/w320/np.png", facts: ["Only non-quadrilateral flag.", "Two triangular pennants.", "Features a moon and sun."] },
            { name: "Netherlands", code: "nl", flagUrl: "https://flagcdn.com/w320/nl.png", facts: ["Red, white, and blue horizontal tricolor.", "One of the oldest tricolors.", "Adopted in 1937."] },
            { name: "Nicaragua", code: "ni", flagUrl: "https://flagcdn.com/w320/ni.png", facts: ["Blue and white horizontal stripes with a coat of arms.", "Blue for oceans, white for peace.", "Coat of arms features a rainbow."] },
            { name: "Niger", code: "ne", flagUrl: "https://flagcdn.com/w320/ne.png", facts: ["Orange, white, and green horizontal stripes with an orange disc.", "Orange for Sahara, white for purity, green for hope.", "Disc for sun."] },
            { name: "Nigeria", code: "ng", flagUrl: "https://flagcdn.com/w320/ng.png", facts: ["Green and white vertical bicolor.", "Green for agriculture, white for peace.", "Adopted in 1960."] },
            { name: "North Macedonia", code: "mk", flagUrl: "https://flagcdn.com/w320/mk.png", facts: ["Red with a yellow sun.", "Sun has eight rays.", "Symbolizes 'new sun of liberty'."] },
            { name: "Norway", code: "no", flagUrl: "https://flagcdn.com/w320/no.png", facts: ["Red with a blue Nordic cross bordered in white.", "Blue and white for Denmark and Sweden.", "Red for independence."] },
            { name: "Oman", code: "om", flagUrl: "https://flagcdn.com/w320/om.png", facts: ["White, red, and green horizontal stripes with a red vertical stripe and emblem.", "Emblem is a khanjar (dagger).", "White for peace, red for battles, green for fertility."] },
            { name: "Pakistan", code: "pk", flagUrl: "https://flagcdn.com/w320/pk.png", facts: ["Green with a white vertical stripe and crescent and star.", "Green for Muslim majority, white for minorities.", "Crescent and star for progress and light."] },
            { name: "Palau", code: "pw", flagUrl: "https://flagcdn.com/w320/pw.png", facts: ["Light blue with a large yellow disc.", "Blue for ocean, yellow disc for moon.", "Moon symbolizes peace."] },
            { name: "Panama", code: "pa", flagUrl: "https://flagcdn.com/w320/pa.png", facts: ["Divided into four quarters with blue and red stars.", "Blue for conservative, red for liberal.", "Stars for purity and law."] },
            { name: "Papua New Guinea", code: "pg", flagUrl: "https://flagcdn.com/w320/pg.png", facts: ["Red and black diagonal halves with a bird of paradise and Southern Cross.", "Bird of paradise is a national emblem.", "Southern Cross for location."] },
            { name: "Paraguay", code: "py", flagUrl: "https://flagcdn.com/w320/py.png", facts: ["Red, white, and blue horizontal tricolor.", "Features two different emblems on front and back.", "Red for justice, white for peace, blue for liberty."] },
            { name: "Peru", code: "pe", flagUrl: "https://flagcdn.com/w320/pe.png", facts: ["Red and white vertical tricolor.", "Red for blood shed for independence, white for peace.", "Adopted in 1825."] },
            { name: "Philippines", code: "ph", flagUrl: "https://flagcdn.com/w320/ph.png", facts: ["Blue and red horizontal stripes with a white triangle, sun, and stars.", "Blue for peace, red for courage, white for equality.", "Sun for liberty, stars for islands."] },
            { name: "Poland", code: "pl", flagUrl: "https://flagcdn.com/w320/pl.png", facts: ["White and red horizontal bicolor.", "White for purity, red for courage.", "Adopted in 1919."] },
            { name: "Portugal", code: "pt", flagUrl: "https://flagcdn.com/w320/pt.png", facts: ["Green and red vertical bicolor with a coat of arms.", "Green for hope, red for courage.", "Coat of arms features an armillary sphere."] },
            { name: "Qatar", code: "qa", flagUrl: "https://flagcdn.com/w320/qa.png", facts: ["Maroon with a white serrated band.", "Nine points represent the nine emirates.", "Maroon is a traditional color."] },
            { name: "Romania", code: "ro", flagUrl: "https://flagcdn.com/w320/ro.png", facts: ["Blue, yellow, and red vertical tricolor.", "Blue for liberty, yellow for justice, red for fraternity.", "Similar to Chad's flag."] },
            { name: "Russia", code: "ru", flagUrl: "https://flagcdn.com/w320/ru.png", facts: ["White, blue, and red horizontal tricolor.", "White for nobility, blue for faithfulness, red for courage.", "Adopted in 1993."] },
            { name: "Rwanda", code: "rw", flagUrl: "https://flagcdn.com/w320/rw.png", facts: ["Light blue, yellow, and green horizontal stripes with a yellow sun.", "Blue for happiness, yellow for economic development, green for prosperity.", "Sun for enlightenment."] },
            { name: "Saint Kitts and Nevis", code: "kn", flagUrl: "https://flagcdn.com/w320/kn.png", facts: ["Green and red triangles with a black diagonal stripe and two stars.", "Green for fertility, red for struggle, black for African heritage.", "Stars for hope."] },
            { name: "Saint Lucia", code: "lc", flagUrl: "https://flagcdn.com/w320/lc.png", facts: ["Blue with a yellow triangle and black and white triangles.", "Blue for ocean, yellow for sun, black and white for racial harmony.", "Triangles for mountains."] },
            { name: "Saint Vincent and the Grenadines", code: "vc", flagUrl: "https://flagcdn.com/w320/vc.png", facts: ["Blue, yellow, and green vertical stripes with three green diamonds.", "Blue for sky, yellow for warmth, green for vegetation.", "Diamonds for strength."] },
            { name: "Samoa", code: "ws", flagUrl: "https://flagcdn.com/w320/ws.png", facts: ["Red with a blue canton and Southern Cross.", "Red for courage, blue for freedom.", "Southern Cross for location."] },
            { name: "San Marino", code: "sm", flagUrl: "https://flagcdn.com/w320/sm.png", facts: ["White and light blue horizontal bicolor with a coat of arms.", "White for snow, blue for sky.", "Coat of arms features three towers."] },
            { name: "Sao Tome and Principe", code: "st", flagUrl: "https://flagcdn.com/w320/st.png", facts: ["Green, yellow, and green horizontal stripes with a red triangle and two black stars.", "Green for vegetation, yellow for sun, red for struggle.", "Stars for islands."] },
            { name: "Saudi Arabia", code: "sa", flagUrl: "https://flagcdn.com/w320/sa.png", facts: ["Green with white Arabic script and a sword.", "Script is the Shahada (Islamic creed).", "Sword for justice."] },
            { name: "Senegal", code: "sn", flagUrl: "https://flagcdn.com/w320/sn.png", facts: ["Green, yellow, and red vertical tricolor with a green star.", "Pan-African colors.", "Star for hope."] },
            { name: "Serbia", code: "rs", flagUrl: "https://flagcdn.com/w320/rs.png", facts: ["Red, blue, and white horizontal tricolor with a coat of arms.", "Red for blood, blue for sky, white for purity.", "Adopted in 2010."] },
            { name: "Seychelles", code: "sc", flagUrl: "https://flagcdn.com/w320/sc.png", facts: ["Blue, yellow, red, white, and green diagonal stripes.", "Blue for sky, yellow for sun, red for people, white for harmony, green for land.", "Adopted in 1996."] },
            { name: "Sierra Leone", code: "sl", flagUrl: "https://flagcdn.com/w320/sl.png", facts: ["Green, white, and blue horizontal tricolor.", "Green for agriculture, white for unity, blue for sea.", "Adopted in 1961."] },
            { name: "Singapore", code: "sg", flagUrl: "https://flagcdn.com/w320/sg.png", facts: ["Red and white horizontal bicolor with a crescent and five stars.", "Red for brotherhood, white for purity.", "Crescent for young nation, stars for ideals."] },
            { name: "Slovakia", code: "sk", flagUrl: "https://flagcdn.com/w320/sk.png", facts: ["White, blue, and red horizontal tricolor with a coat of arms.", "Coat of arms features a double cross.", "Adopted in 1992."] },
            { name: "Slovenia", code: "si", flagUrl: "https://flagcdn.com/w320/si.png", facts: ["White, blue, and red horizontal tricolor with a coat of arms.", "Coat of arms features Mount Triglav.", "Adopted in 1991."] },
            { name: "Solomon Islands", code: "sb", flagUrl: "https://flagcdn.com/w320/sb.png", facts: ["Green and blue diagonal halves with a yellow stripe and five stars.", "Green for land, blue for ocean, yellow for sun.", "Stars for provinces."] },
            { name: "Somalia", code: "so", flagUrl: "https://flagcdn.com/w320/so.png", facts: ["Light blue with a white star.", "Blue for UN, white star for African freedom.", "Adopted in 1954."] },
            { name: "South Sudan", code: "ss", flagUrl: "https://flagcdn.com/w320/ss.png", facts: ["Black, red, and green horizontal stripes with a blue triangle and yellow star.", "Black for people, red for blood, green for land.", "Star for unity."] },
            { name: "Sri Lanka", code: "lk", flagUrl: "https://flagcdn.com/w320/lk.png", facts: ["Green and orange vertical stripes with a maroon field and lion.", "Lion holds a sword.", "Green for Muslims, orange for Tamils, maroon for Sinhalese."] },
            { name: "Sudan", code: "sd", flagUrl: "https://flagcdn.com/w320/sd.png", facts: ["Red, white, and black horizontal stripes with a green triangle.", "Red for sacrifice, white for peace, black for Sudan.", "Green for Islam."] },
            { name: "Suriname", code: "sr", flagUrl: "https://flagcdn.com/w320/sr.png", facts: ["Green, white, and red horizontal stripes with a yellow star.", "Green for resources, white for justice, red for progress.", "Star for unity."] },
            { name: "Switzerland", code: "ch", flagUrl: "https://flagcdn.com/w320/ch.png", facts: ["Red with a white cross.", "Square flag.", "Cross for Christianity."] },
            { name: "Syria", code: "sy", flagUrl: "https://flagcdn.com/w320/sy.png", facts: ["Red, white, and black horizontal stripes with two green stars.", "Red for sacrifice, white for purity, black for oppression.", "Stars for unity."] },
            { name: "Taiwan", code: "tw", flagUrl: "https://flagcdn.com/w320/tw.png", facts: ["Red with a blue canton and white sun.", "Blue for liberty, white for equality, red for fraternity.", "Sun for progress."] },
            { name: "Tajikistan", code: "tj", flagUrl: "https://flagcdn.com/w320/tj.png", facts: ["Red, white, and green horizontal stripes with a crown and stars.", "Red for unity, white for cotton, green for agriculture.", "Crown for sovereignty."] },
            { name: "Tanzania", code: "tz", flagUrl: "https://flagcdn.com/w320/tz.png", facts: ["Green and blue diagonal halves with a black stripe bordered in yellow.", "Green for land, blue for ocean, black for people, yellow for mineral wealth.", "Adopted in 1964."] },
            { name: "Thailand", code: "th", flagUrl: "https://flagcdn.com/w320/th.png", facts: ["Red, white, and blue horizontal stripes.", "Blue stripe is wider.", "Red for nation, white for religion, blue for monarchy."] },
            { name: "Timor-Leste", code: "tl", flagUrl: "https://flagcdn.com/w320/tl.png", facts: ["Red with black and yellow triangles and a white star.", "Red for struggle, black for colonialism, yellow for independence.", "Star for peace."] },
            { name: "Togo", code: "tg", flagUrl: "https://flagcdn.com/w320/tg.png", facts: ["Green and yellow horizontal stripes with a red square and white star.", "Green for agriculture, yellow for wealth, red for sacrifice.", "Star for hope."] },
            { name: "Tonga", code: "to", flagUrl: "https://flagcdn.com/w320/to.png", facts: ["Red with a white canton and red cross.", "Red for blood of Christ, white for purity.", "Cross for Christianity."] },
            { name: "Trinidad and Tobago", code: "tt", flagUrl: "https://flagcdn.com/w320/tt.png", facts: ["Red with a black diagonal stripe bordered in white.", "Red for sun, black for people, white for sea.", "Adopted in 1962."] },
            { name: "Tunisia", code: "tn", flagUrl: "https://flagcdn.com/w320/tn.png", facts: ["Red with a white disc and red crescent and star.", "Red for martyrs, white for peace.", "Crescent and star for Islam."] },
            { name: "Turkmenistan", code: "tm", flagUrl: "https://flagcdn.com/w320/tm.png", facts: ["Green with a vertical red stripe and five carpet guls.", "Green for Islam, red for traditional carpets.", "Five guls for five major tribes."] },
            { name: "Uganda", code: "ug", flagUrl: "https://flagcdn.com/w320/ug.png", facts: ["Black, yellow, and red horizontal stripes with a grey crowned crane.", "Black for African people, yellow for sun, red for brotherhood.", "Crane is a national symbol."] },
            { name: "Ukraine", code: "ua", flagUrl: "https://flagcdn.com/w320/ua.png", facts: ["Blue and yellow horizontal bicolor.", "Blue for sky, yellow for wheat fields.", "Adopted in 1992."] },
            { name: "United Arab Emirates", code: "ae", flagUrl: "https://flagcdn.com/w320/ae.png", facts: ["Green, white, and black horizontal stripes with a red vertical stripe.", "Green for land, white for peace, black for oil, red for unity.", "Adopted in 1971."] },
            { name: "Uruguay", code: "uy", flagUrl: "https://flagcdn.com/w320/uy.png", facts: ["Nine white and blue horizontal stripes with a Sun of May.", "Nine stripes for original departments.", "Sun of May for independence."] },
            { name: "Uzbekistan", code: "uz", flagUrl: "https://flagcdn.com/w320/uz.png", facts: ["Light blue, white, and green horizontal stripes with a crescent and stars.", "Blue for sky, white for peace, green for nature.", "Crescent for Islam, stars for regions."] },
            { name: "Vanuatu", code: "vu", flagUrl: "https://flagcdn.com/w320/vu.png", facts: ["Red, green, and black triangles with a yellow Y-shape and boar's tusk.", "Red for blood, green for land, black for people.", "Y-shape for islands."] },
            { name: "Venezuela", code: "ve", flagUrl: "https://flagcdn.com/w320/ve.png", facts: ["Yellow, blue, and red horizontal tricolor with stars and coat of arms.", "Yellow for wealth, blue for ocean, red for independence.", "Stars for provinces."] },
            { name: "Vietnam", code: "vn", flagUrl: "https://flagcdn.com/w320/vn.png", facts: ["Red with a yellow star.", "Red for revolution, yellow star for people.", "Adopted in 1976."] },
            { name: "Yemen", code: "ye", flagUrl: "https://flagcdn.com/w320/ye.png", facts: ["Red, white, and black horizontal tricolor.", "Red for unity, white for peace, black for dark past.", "Adopted in 1990."] },
            { name: "Zambia", code: "zm", flagUrl: "https://flagcdn.com/w320/zm.png", facts: ["Green with a red, black, and orange vertical stripe and an eagle.", "Green for agriculture, red for struggle, black for people, orange for mineral wealth.", "Eagle for freedom."] },
            { name: "Zimbabwe", code: "zw", flagUrl: "https://flagcdn.com/w320/zw.png", facts: ["Green, yellow, red, and black horizontal stripes with a white triangle and bird.", "Green for agriculture, yellow for mineral wealth, red for blood, black for people.", "Bird for heritage."] },
            { name: "Anguilla", code: "ai", flagUrl: "https://flagcdn.com/w320/ai.png", facts: ["Blue Ensign with the coat of arms.", "Coat of arms features three dolphins.", "Blue for sea, dolphins for endurance."] },
            { name: "Aruba", code: "aw", flagUrl: "https://flagcdn.com/w320/aw.png", facts: ["Light blue with two yellow horizontal stripes and a red star.", "Blue for sea, yellow for sun, red for love.", "Star for island."] },
            { name: "Bermuda", code: "bm", flagUrl: "https://flagcdn.com/w320/bm.png", facts: ["Red Ensign with the coat of arms.", "Coat of arms features a lion and shipwreck.", "Red for courage, lion for strength."] },
            { name: "Cayman Islands", code: "ky", flagUrl: "https://flagcdn.com/w320/ky.png", facts: ["Blue Ensign with the coat of arms.", "Coat of arms features a pineapple, turtle, and lion.", "Blue for sea, turtle for longevity."] },
            { name: "Falkland Islands", code: "fk", flagUrl: "https://flagcdn.com/w320/fk.png", facts: ["Blue Ensign with the coat of arms.", "Coat of arms features a ram and ship.", "Blue for sea, ram for agriculture."] },
            { name: "Gibraltar", code: "gi", flagUrl: "https://flagcdn.com/w320/gi.png", facts: ["White with a red castle and key.", "Castle for fortress, key for strategic location.", "Adopted in 1982."] },
            { name: "Greenland", code: "gl", flagUrl: "https://flagcdn.com/w320/gl.png", facts: ["Red and white horizontal bicolor with a disc.", "Red for sun, white for ice.", "Disc for sun and ice."] },
            { name: "Guam", code: "gu", flagUrl: "https://flagcdn.com/w320/gu.png", facts: ["Dark blue with a red border and coat of arms.", "Coat of arms features a proa and palm tree.", "Blue for sea, red for blood."] },
            { name: "Guernsey", code: "gg", flagUrl: "https://flagcdn.com/w320/gg.png", facts: ["White with a red cross and golden cross.", "Red cross for St George, golden cross for William the Conqueror.", "Adopted in 1985."] },
            { name: "Isle of Man", code: "im", flagUrl: "https://flagcdn.com/w320/im.png", facts: ["Red with a triskelion.", "Triskelion is three conjoined legs.", "Symbolizes stability."] },
            { name: "Jersey", code: "je", flagUrl: "https://flagcdn.com/w320/je.png", facts: ["White with a red saltire and coat of arms.", "Red saltire for St Patrick.", "Coat of arms features three lions."] },
            { name: "Montserrat", code: "ms", flagUrl: "https://flagcdn.com/w320/ms.png", facts: ["Blue Ensign with the coat of arms.", "Coat of arms features a woman with a cross and harp.", "Blue for sea, woman for justice."] },
            { name: "Pitcairn Islands", code: "pn", flagUrl: "https://flagcdn.com/w320/pn.png", facts: ["Blue Ensign with the coat of arms.", "Coat of arms features an anchor and Bible.", "Blue for sea, anchor for hope."] },
            { name: "Saint Helena", code: "sh", flagUrl: "https://flagcdn.com/w320/sh.png", facts: ["Blue Ensign with the coat of arms.", "Coat of arms features a ship and wirebird.", "Blue for sea, wirebird for rarity."] },
            { name: "Turks and Caicos Islands", code: "tc", flagUrl: "https://flagcdn.com/w320/tc.png", facts: ["Blue Ensign with the coat of arms.", "Coat of arms features a conch, lobster, and cactus.", "Blue for sea, conch for shell."] },
            { name: "Virgin Islands (British)", code: "vg", flagUrl: "https://flagcdn.com/w320/vg.png", facts: ["Blue Ensign with the coat of arms.", "Coat of arms features Saint Ursula and lamps.", "Blue for sea, lamps for wisdom."] },
            { name: "Virgin Islands (U.S.)", code: "vi", flagUrl: "https://flagcdn.com/w320/vi.png", facts: ["White with a golden eagle and initials.", "Eagle for USA, initials for Virgin Islands.", "Adopted in 1921."] },
            { name: "Wallis and Futuna", code: "wf", flagUrl: "https://flagcdn.com/w320/wf.png", facts: ["Red with a white square and red cross.", "Red for courage, white for purity.", "Cross for Christianity."] },
            { name: "Western Sahara", code: "eh", flagUrl: "https://flagcdn.com/w320/eh.png", facts: ["Black, white, and green horizontal stripes with a red triangle and star and crescent.", "Black for dark past, white for peace, green for prosperity.", "Star and crescent for Islam."] },
            { name: "Aland Islands", code: "ax", flagUrl: "https://flagcdn.com/w320/ax.png", facts: ["Blue with a yellow Nordic cross and red cross.", "Blue for sea, yellow for sun, red for blood.", "Adopted in 1954."] },
            { name: "American Samoa", code: "as", flagUrl: "https://flagcdn.com/w320/as.png", facts: ["Blue with a white triangle and red border and eagle.", "Blue for USA, white for purity, red for courage.", "Eagle for freedom."] },
            { name: "Cook Islands", code: "ck", flagUrl: "https://flagcdn.com/w320/ck.png", facts: ["Blue Ensign with 15 white stars.", "Blue for Pacific Ocean, stars for islands.", "Adopted in 1979."] },
            { name: "Faroe Islands", code: "fo", flagUrl: "https://flagcdn.com/w320/fo.png", facts: ["White with a red Nordic cross bordered in blue.", "White for purity, red for blood, blue for sea.", "Adopted in 1940."] },
            { name: "French Polynesia", code: "pf", flagUrl: "https://flagcdn.com/w320/pf.png", facts: ["Red and white horizontal stripes with a coat of arms.", "Red for courage, white for peace.", "Coat of arms features a canoe and sun."] },
            { name: "Guadeloupe", code: "gp", flagUrl: "https://flagcdn.com/w320/gp.png", facts: ["Black with a yellow sun and green sugarcane.", "Black for people, yellow for sun, green for agriculture.", "Adopted in 1970s."] },
            { name: "Martinique", code: "mq", flagUrl: "https://flagcdn.com/w320/mq.png", facts: ["Black with a yellow snake and white cross.", "Snake is a local symbol.", "Black for people, yellow for sun, white for purity."] },
            { name: "Mayotte", code: "yt", flagUrl: "https://flagcdn.com/w320/yt.png", facts: ["White with a blue border and coat of arms.", "Coat of arms features a dhow and ylang-ylang flower.", "White for purity, blue for sea."] },
            { name: "New Caledonia", code: "nc", flagUrl: "https://flagcdn.com/w320/nc.png", facts: ["Blue, red, and green horizontal stripes with a black emblem.", "Blue for ocean, red for blood, green for land.", "Emblem is a flèche faîtière."] },
            { name: "Norfolk Island", code: "nf", flagUrl: "https://flagcdn.com/w320/nf.png", facts: ["Green and white vertical stripes with a Norfolk Island pine.", "Green for vegetation, white for purity.", "Pine is a national symbol."] },
            { name: "Northern Mariana Islands", code: "mp", flagUrl: "https://flagcdn.com/w320/mp.png", facts: ["Blue with a white star and latte stone and wreath.", "Blue for Pacific Ocean, star for USA, latte stone for culture.", "Wreath for peace."] },
            { name: "Puerto Rico", code: "pr", flagUrl: "https://flagcdn.com/w320/pr.png", facts: ["Red and white stripes with a blue triangle and white star.", "Red for blood, white for peace, blue for sky.", "Star for island."] },
            { name: "Réunion", code: "re", flagUrl: "https://flagcdn.com/w320/re.png", facts: ["Blue with a red triangle and yellow sun.", "Blue for sky, red for sun, yellow for prosperity.", "Adopted in 1970s."] },
            { name: "Saint Pierre and Miquelon", code: "pm", flagUrl: "https://flagcdn.com/w320/pm.png", facts: ["Blue with a yellow ship and three squares.", "Ship represents Jacques Cartier.", "Squares for Basque, Breton, Norman heritage."] },
            { name: "Sint Maarten", code: "sx", flagUrl: "https://flagcdn.com/w320/sx.png", facts: ["Blue and red horizontal stripes with a white triangle and coat of arms.", "Blue for sea, red for courage, white for purity.", "Coat of arms features a courthouse."] },
            { name: "Tokelau", code: "tk", flagUrl: "https://flagcdn.com/w320/tk.png", facts: ["Blue with a yellow canoe and four stars.", "Blue for Pacific Ocean, canoe for journey, stars for islands.", "Adopted in 2009."] },
            { name: "Tuvalu", code: "tv", flagUrl: "https://flagcdn.com/w320/tv.png", facts: ["Light blue with the Union Jack and nine yellow stars.", "Blue for Pacific Ocean, stars for islands.", "Adopted in 1978."] },
            { name: "United States Minor Outlying Islands", code: "um", flagUrl: "https://flagcdn.com/w320/um.png", facts: ["Stars and Stripes.", "Represents US territories.", "Official flag of the USA."] }
        ];

        // --- DOM Elements ---
        const starterScreen = document.getElementById('starter-screen');
        const gameContent = document.getElementById('game-content');
        const startButton = document.getElementById('start-button');
        const messageBoxElement = document.getElementById('message-box');
        // Flag Game Elements
        const flagGameSection = document.getElementById('flag-game-section');
        const gameTitleElement = document.getElementById('game-title');
        const flagImageElement = document.getElementById('flag-image');
        const countryOptionsElement = document.getElementById('country-options');
        const feedbackMessageElement = document.getElementById('feedback-message');
        const factsSectionElement = document.getElementById('facts-section');
        const factListElement = document.getElementById('fact-list');
        const nextButtonElement = document.getElementById('next-button');
        const userScoreElement = document.getElementById('user-score');
        const flagsSeenElement = document.getElementById('flags-seen');
        const totalFlagsElement = document.getElementById('total-flags');
        const currentRoundElement = document.getElementById('current-round');
        const totalRoundsElement = document.getElementById('total-rounds');
        const roundsLeftElement = document.getElementById('rounds-left');

        // Drawing Game Elements
        const drawingGameSection = document.getElementById('drawing-game-section');
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        const clearBtn = document.getElementById('clearBtn');
        const guessBtn = document.getElementById('guessBtn');
        const resultText = document.getElementById('resultText');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const downloadBtn = document.getElementById('downloadBtn');
        const aiFeedbackButtons = document.getElementById('ai-feedback-buttons');
        const aiCorrectBtn = document.getElementById('aiCorrectBtn');
        const aiWrongBtn = document.getElementById('aiWrongBtn');
        const aiScoreElement = document.getElementById('ai-score');

        // --- Game State ---
        let currentCountry;
        let userScore = 0;
        let aiScore = 0;
        let flagsShownCount = 0;
        let availableCountries = [];
        const ROUNDS_PER_GAME = 20; // Define the number of flags to show per game cycle
        let currentGameMode = 'flags'; // 'flags' or 'drawing'
        let isUserTurn = true; // Track whose turn it is (true = user's turn, false = AI's turn)

        // Drawing state variables
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;

        // --- Utility Functions ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function showMessage(text, type = 'success', duration = 3000) {
            messageBoxElement.textContent = text;
            messageBoxElement.className = '';
            messageBoxElement.classList.add(type);
            messageBoxElement.style.display = 'block';
            setTimeout(() => {
                messageBoxElement.style.display = 'none';
            }, duration);
        }

        // --- Flag Game Logic ---
        function loadNextFlag() {
            feedbackMessageElement.textContent = '';
            feedbackMessageElement.className = 'text-lg font-semibold';
            factsSectionElement.classList.add('hidden');
            factListElement.innerHTML = '';
            nextButtonElement.classList.add('hidden');
            countryOptionsElement.innerHTML = '';

            if (flagsShownCount >= ROUNDS_PER_GAME || availableCountries.length === 0) {
                showMessage("Starting a new game! New flags coming up...", 'success');
                availableCountries = [...countriesData];
                shuffleArray(availableCountries);
                flagsShownCount = 0;
                userScore = 0;
                aiScore = 0;
                userScoreElement.textContent = userScore;
                aiScoreElement.textContent = aiScore;

                // Reset round counter
                currentRoundElement.textContent = "1";
                roundsLeftElement.textContent = ROUNDS_PER_GAME / 2;
            }

            flagsShownCount++;
            flagsSeenElement.textContent = flagsShownCount;

            // Update round counter
            const currentRound = Math.ceil(flagsShownCount / 2); // Each complete round consists of a flag game and drawing game
            const roundsLeft = ROUNDS_PER_GAME / 2 - currentRound + 1;
            currentRoundElement.textContent = currentRound;
            totalRoundsElement.textContent = ROUNDS_PER_GAME / 2;
            roundsLeftElement.textContent = roundsLeft > 0 ? roundsLeft : 0;

            if (availableCountries.length > 0) {
                currentCountry = availableCountries.pop();
            } else {
                console.error("Available countries list is empty unexpectedly. Reloading game.");
                loadNextFlag();
                return;
            }

            // Update game title based on whose turn it is
            gameTitleElement.textContent = isUserTurn ? 'Your Turn: Guess the Flag!' : 'My Turn: Guess the Flag!';
            flagImageElement.src = currentCountry.flagUrl;
            flagImageElement.alt = `Flag of ${currentCountry.name}`;
            flagImageElement.onerror = function() {
                this.src = 'https://placehold.co/200x120/e2e8f0/FF0000?text=Error+Loading+Flag';
                this.alt = 'Error loading flag';
                showMessage(`Could not load flag for ${currentCountry.name}. Skipping.`, 'error');
                setTimeout(loadNextFlag, 1500);
            };

            const options = [currentCountry.name];
            const otherCountries = countriesData.filter(c => c.name !== currentCountry.name);
            shuffleArray(otherCountries);

            for (let i = 0; i < 3 && i < otherCountries.length; i++) {
                options.push(otherCountries[i].name);
            }

            shuffleArray(options);

            options.forEach(optionName => {
                const button = document.createElement('button');
                button.textContent = optionName;
                button.classList.add(
                    'option-button', 'w-full', 'bg-white', 'hover:bg-gray-100',
                    'text-slate-700', 'font-semibold', 'py-3', 'px-4',
                    'border', 'border-gray-300', 'rounded-lg', 'shadow-sm'
                );
                button.addEventListener('click', () => handleOptionClick(optionName, button));
                countryOptionsElement.appendChild(button);
            });
        }

        function handleOptionClick(selectedName, clickedButton) {
            const buttons = countryOptionsElement.querySelectorAll('button');
            buttons.forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === currentCountry.name) {
                    btn.classList.add('correct-answer');
                } else if (btn === clickedButton && selectedName !== currentCountry.name) {
                    btn.classList.add('incorrect-answer');
                }
                if (btn.textContent !== currentCountry.name && btn !== clickedButton) {
                    btn.classList.add('opacity-60');
                }
            });

            if (selectedName === currentCountry.name) {
                feedbackMessageElement.textContent = 'Correct!';
                feedbackMessageElement.classList.remove('text-red-500');
                feedbackMessageElement.classList.add('text-green-500');
                userScore++;
                userScoreElement.textContent = userScore;
                showMessage('Well done!', 'success', 1500);
            } else {
                feedbackMessageElement.textContent = `Incorrect. This is the flag of ${currentCountry.name}.`;
                feedbackMessageElement.classList.remove('text-green-500');
                feedbackMessageElement.classList.add('text-red-500');
                showMessage(`Not quite! That was ${currentCountry.name}.`, 'error', 2000);
            }

            currentCountry.facts.forEach(fact => {
                const listItem = document.createElement('li');
                listItem.textContent = fact;
                factListElement.appendChild(listItem);
            });
            factsSectionElement.classList.remove('hidden');

            nextButtonElement.classList.remove('hidden');
            // Update button text based on whose turn it is
            nextButtonElement.textContent = isUserTurn ? "Your Turn" : "My Turn";

            nextButtonElement.addEventListener('click', () => {
                // Toggle turn when button is clicked
                isUserTurn = !isUserTurn;
                // Update button text immediately after click
                nextButtonElement.textContent = isUserTurn ? "Your Turn" : "My Turn";
                setGameMode('drawing'); // Switch to drawing game after flag guess
            }, { once: true }); // Ensure this listener runs only once
        }

        // --- Drawing Game Logic ---
        let drawingIsSetup = false; // To ensure canvas setup runs only once

        function setupCanvas() {
            if (drawingIsSetup) return; // Prevent re-running setup
            const setCanvasDimensions = () => {
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width;
                canvas.height = rect.height;
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            };

            setCanvasDimensions();
            window.addEventListener('resize', setCanvasDimensions);

            ctx.lineWidth = 5;
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#000000';

            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                startDrawing({ offsetX: touch.clientX - canvas.getBoundingClientRect().left, offsetY: touch.clientY - canvas.getBoundingClientRect().top });
            });
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                draw({ offsetX: touch.clientX - canvas.getBoundingClientRect().left, offsetY: touch.clientY - canvas.getBoundingClientRect().top });
            });
            canvas.addEventListener('touchend', stopDrawing);
            drawingIsSetup = true;
        }

        function startDrawing(e) {
            isDrawing = true;
            [lastX, lastY] = [e.offsetX, e.offsetY];
        }

        function draw(e) {
            if (!isDrawing) return;
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(e.offsetX, e.offsetY);
            ctx.stroke();
            [lastX, lastY] = [e.offsetX, e.offsetY];
        }

        function stopDrawing() {
            isDrawing = false;
        }

        clearBtn.addEventListener('click', () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#FFFFFF';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            resultText.textContent = '';
            loadingIndicator.classList.add('hidden');
            aiFeedbackButtons.classList.add('hidden'); // Hide feedback buttons on clear
        });

        guessBtn.addEventListener('click', async () => {
            resultText.textContent = '';
            loadingIndicator.classList.remove('hidden');
            aiFeedbackButtons.classList.add('hidden'); // Hide feedback buttons before new guess

            const imageDataURL = canvas.toDataURL('image/png');
            const base64ImageData = imageDataURL.split(',')[1];
            console.log("Base64 Image Data Length:", base64ImageData.length);

            try {
                const prompt = "What's this supposed to be? A masterpiece? *eye roll* Tell me what you think this drawing is, and don't hold back the sass. Add a quick jab about how easy or hard it was to figure out. Keep it short and snappy - I don't have all day for your artistic adventures. No formal descriptions, just tell me what you see like we're trash-talking friends.";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${API_KEY}`;

                const payload = {
                    contents: [
                        {
                            role: "user",
                            parts: [
                                { text: prompt },
                                {
                                    inlineData: {
                                        mimeType: "image/png",
                                        data: base64ImageData
                                    }
                                }
                            ]
                        }
                    ],
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API error: ${response.status} - ${errorData.error.message || 'Unknown error'}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    resultText.textContent = text;
                    aiFeedbackButtons.classList.remove('hidden'); // Show feedback buttons after AI guess
                } else {
                    resultText.textContent = 'Harry could not make a guess. Try drawing something clearer!';
                }
            } catch (error) {
                console.error('Error submitting drawing to AI:', error);
                resultText.textContent = `Error: ${error.message}. Please try again.`;
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        });

        downloadBtn.addEventListener('click', () => {
            const imageDataURL = canvas.toDataURL('image/png');
            const link = document.createElement('a');
            link.download = 'drawing.png';
            link.href = imageDataURL;
            link.click();
        });

        aiCorrectBtn.addEventListener('click', () => {
            aiScore++;
            aiScoreElement.textContent = aiScore;
            showMessage('Harry got a point!', 'success', 1500);
            // Toggle turn when returning to flag game
            isUserTurn = !isUserTurn;
            setGameMode('flags'); // Switch back to flag game after Harry feedback
        });

        aiWrongBtn.addEventListener('click', () => {
            showMessage('Harry did not get a point.', 'error', 1500);
            // Toggle turn when returning to flag game
            isUserTurn = !isUserTurn;
            setGameMode('flags'); // Switch back to flag game after Harry feedback
        });

        // --- Game Mode Switching ---
        function setGameMode(mode) {
            currentGameMode = mode;
            if (mode === 'flags') {
                flagGameSection.classList.remove('hidden');
                drawingGameSection.classList.add('hidden');

                // Update game title based on whose turn it is
                gameTitleElement.textContent = isUserTurn ? 'Your Turn: Guess the Flag!' : 'My Turn: Guess the Flag!';

                // Update button text based on whose turn it is
                nextButtonElement.textContent = isUserTurn ? "Your Turn" : "My Turn";

                loadNextFlag(); // Ensure flag game is ready
            } else { // mode === 'drawing'
                flagGameSection.classList.add('hidden');
                drawingGameSection.classList.remove('hidden');

                // Update game title based on whose turn it is
                gameTitleElement.textContent = isUserTurn ? 'Your Turn: Draw & Guess!' : 'My Turn: Draw & Guess!';

                setupCanvas(); // Setup canvas when switching to drawing mode
                clearBtn.click(); // Clear canvas on switch
            }
        }

        // --- Event Listeners ---

        startButton.addEventListener('click', () => {
            starterScreen.style.display = 'none';
            gameContent.style.display = 'block';
            // Initialize availableCountries with a shuffled copy of all countries
            availableCountries = [...countriesData];
            shuffleArray(availableCountries);

            totalFlagsElement.textContent = countriesData.length;

            // Initialize round counter
            currentRoundElement.textContent = "1";
            totalRoundsElement.textContent = ROUNDS_PER_GAME / 2;
            roundsLeftElement.textContent = ROUNDS_PER_GAME / 2;

            // Initialize turn state
            isUserTurn = true;

            setGameMode('flags'); // Start in flag guessing mode
        });

        // --- Initial Load ---
        window.onload = () => {
            gameContent.style.display = 'none';
        };
    </script>

</body>
</html>
